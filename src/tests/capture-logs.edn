(defmesh root)

(defloop inline-capture
  (CaptureLog
   :Size 8
   :MinLevel "trace"
   :Pattern "%^[%l]%$ [%Y-%m-%d %T.%e] %v")
  (ExpectStringSeq)
  (Msg "Hello shards!"))

(schedule root inline-capture)
(if (run root 0.05 16) nil (throw "Root tick failed"))

(defloop capture
  (CaptureLog
   :Size 8
   :MinLevel "trace"
   :Pattern "%^[%l]%$ [%Y-%m-%d %T.%e] %v"
   :Suspend true)
  (ExpectStringSeq))
(defloop detach-capture
  (Setup
   (Detach capture))
  (Msg "Hello shards!"))

(schedule root detach-capture)
(if (run root 0.05 16) nil (throw "Root tick failed"))
